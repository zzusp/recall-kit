# Feature Specification: 经验分享平台

**Feature Branch**: `001-experience-sharing-platform`  
**Created**: 2025-01-27  
**Status**: Draft  
**Input**: User description: "项目背景：因为在vibe coding过程中，经常会出现AI抓不到重点、而用户又不知道问题在哪里，而这时用户往往只会通过"问题没修复"、"不是我要的效果"、"为什么没按照我之前的描述来"之类的提示词来继续对话，而AI只能不断尝试各种解决方案，从而造成了对话成本增加、token浪费的情况。项目说明：基于背景中的情况，我准备开发一个平台，平台有mcp server和mcp client，用户与AI斗智斗勇的经验，可以使用AI总结后，通过mcp调用的方式保存到平台上，在后续coding过程中，如果遇到类似的情况，就可以通过mcp的方式获取到之前的经验，这样就能避免类似情况重复发生。那么，这个系统将会分为四个大的模块：1. 检索模块：系统官网首页、搜索页、列表页、登录页，主要是平台介绍、数据检索等 2. 管理模块：登陆后可访问的控制面板页、数据审核页、数据编辑页、系统设置（AI集成），主要用来维护管理 3. mcp server：用来接收agent的查询请求，查询库中相关记录，并按照固定格式返回 4. mcp client：安装在agent端的client。1. 分析agent所需要的数据，并转为mcp server支持的请求格式，发起请求，接收结果，并按照固定格式解析后，返回给agent。2. 通过client按照固定的格式总结经验，保存至mcp server端"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Agent通过MCP Client查询相关经验 (Priority: P1)

开发者在coding过程中，当AI无法理解需求或出现沟通问题时，Agent可以通过MCP Client自动查询平台中是否有类似的经验记录，获取之前成功解决类似问题的经验，从而快速定位问题并给出正确的解决方案。

**Why this priority**: 这是平台的核心价值所在 - 通过经验复用减少重复对话和token浪费。没有这个功能，平台就失去了存在的意义。

**Independent Test**: 可以独立测试：安装MCP Client后，Agent发起查询请求，系统能够返回相关的经验记录，Agent能够解析并使用这些经验。这个功能可以独立运行并交付价值。

**Acceptance Scenarios**:

1. **Given** Agent在coding过程中遇到AI无法理解需求的情况，**When** Agent通过MCP Client发起查询请求，**Then** MCP Server返回平台中已发布的、与查询相关的经验记录列表（全局共享），按综合排序规则排列（相关性得分为主，结合使用频率和发布时间），默认返回前10条最相关的记录
2. **Given** Agent需要更多查询结果，**When** Agent通过MCP Client请求更多记录（如20条、50条），**Then** MCP Server返回指定数量的经验记录
3. **Given** MCP Server返回了经验记录，**When** MCP Client解析返回结果，**Then** Agent能够获取到结构化的经验信息（问题描述、解决方案、关键要点等）
4. **Given** 平台中没有匹配的经验记录，**When** Agent发起查询请求，**Then** MCP Server返回空结果或提示信息

---

### User Story 2 - Agent通过MCP Client保存新经验 (Priority: P1)

开发者在coding过程中成功解决了某个问题后，Agent可以通过MCP Client自动总结这次交互经验，并将经验保存到平台中，供后续查询使用。

**Why this priority**: 这是平台数据积累的基础。只有不断积累经验，查询功能才能发挥作用。与查询功能同等重要，共同构成平台的闭环。

**Independent Test**: 可以独立测试：Agent通过MCP Client总结经验并提示用户确认，用户同意后提交，MCP Server接收并保存经验记录。这个功能可以独立运行并交付价值。

**Acceptance Scenarios**:

1. **Given** Agent成功解决了某个问题，**When** Agent通过MCP Client总结经验并提示用户确认，**Then** 用户确认后，MCP Server接收并保存经验记录，记录自动发布并立即可被查询
2. **Given** Agent总结了经验并提示用户确认，**When** 用户同意提交且数据格式符合要求、context字段如果包含代码片段则通过脱敏验证，**Then** 系统AI自动生成关键字，用户可编辑或添加自定义关键字，经验记录被保存并自动发布，立即可被其他用户查询
3. **Given** Agent总结了经验并提示用户确认，**When** 用户拒绝提交，**Then** 经验记录不被保存，用户可继续使用Agent
4. **Given** Agent提交了格式不正确的经验数据，**When** MCP Server验证数据，**Then** 返回错误信息并拒绝保存

---

### User Story 3 - 用户通过Web界面搜索和浏览经验 (Priority: P2)

用户可以通过Web界面匿名访问平台，浏览和搜索已发布的经验记录，了解常见问题和解决方案，学习最佳实践。无需注册或登录即可使用。

**Why this priority**: Web界面提供了人工检索和学习的渠道，虽然不如MCP自动查询高效，但对于用户主动学习和探索仍然重要。优先级低于MCP功能，因为核心价值在于自动化。

**Independent Test**: 可以独立测试：用户访问网站首页，可以搜索和浏览经验记录，查看详细信息。这个功能可以独立运行并交付价值。

**Acceptance Scenarios**:

1. **Given** 用户（未登录）访问平台首页，**When** 用户浏览经验列表，**Then** 系统显示已发布的经验记录列表
2. **Given** 用户（未登录）在搜索页输入关键词，**When** 用户执行搜索，**Then** 系统返回匹配的经验记录，默认显示前10条，支持分页加载更多
3. **Given** 用户（未登录）在搜索页输入关键词，**When** 搜索没有匹配结果，**Then** 系统只显示"未找到匹配结果"，不提供任何推荐
4. **Given** 用户（未登录）点击某个经验记录，**When** 用户查看详情，**Then** 系统显示完整的经验信息（问题描述、解决方案、相关关键字等）

---

### User Story 4 - 管理员审核和管理经验记录 (Priority: P2)

管理后台登录后可以审核和管理已发布的经验记录，编辑或删除记录，确保平台内容的质量和准确性。

**Why this priority**: 内容质量是平台可信度的基础。虽然记录自动发布，但需要管理员能够及时发现和处理问题内容。优先级低于核心功能，但仍然是平台长期运营的关键。

**Independent Test**: 可以独立测试：管理后台登录后，可以查看已发布的经验记录列表，编辑或删除记录。这个功能可以独立运行并交付价值。

**Acceptance Scenarios**:

1. **Given** 管理员已登录，**When** 管理员访问管理页面，**Then** 系统显示所有已发布的经验记录列表
2. **Given** 管理员查看某个已发布的记录，**When** 管理员发现内容有问题并编辑，**Then** 修改后的内容被保存并更新
3. **Given** 管理员发现某个已发布的记录不合适，**When** 管理员删除记录，**Then** 记录被标记为已删除状态，数据永久归档但不可查询，不再出现在查询结果中
4. **Given** 管理员误删了某个记录，**When** 管理员需要恢复已删除的记录，**Then** 系统允许管理员恢复已归档的记录，恢复后记录重新变为已发布状态
5. **Given** 管理员需要批量删除多个记录，**When** 管理员选择多个记录并执行批量删除，**Then** 系统批量删除选中的记录，标记为已删除状态
6. **Given** 管理员需要批量恢复多个已删除的记录，**When** 管理员选择多个已删除记录并执行批量恢复，**Then** 系统批量恢复选中的记录，重新变为已发布状态
7. **Given** 管理员需要审核新发布的记录，**When** 管理员访问管理页面，**Then** 系统可以按时间排序显示最近发布的记录，便于管理员审核

---

### User Story 5 - 管理后台登录和后台管理 (Priority: P3)

管理员可以通过登录功能访问后台管理模块，审核经验记录、编辑内容、管理系统设置等。普通用户无需登录即可使用MCP和Web界面功能。

**Why this priority**: 登录功能是访问后台管理功能的前提，但对于核心的MCP功能和Web浏览功能不是必需的。优先级较低，可以在MVP之后实现。

**Independent Test**: 可以独立测试：管理员可以注册账户、登录、访问后台管理功能。这个功能可以独立运行并交付价值。

**Acceptance Scenarios**:

1. **Given** 系统初始化时，**When** 创建第一个管理员账户，**Then** 系统创建管理员账户并完成初始化
2. **Given** 现有管理员已登录，**When** 管理员添加新管理员账户，**Then** 系统创建新的管理员账户
3. **Given** 管理员访问登录页，**When** 管理员使用正确的凭据登录，**Then** 系统验证身份并允许访问后台管理功能
4. **Given** 管理员已登录，**When** 管理员访问控制面板，**Then** 系统显示已发布的经验记录和统计信息

---

### Edge Cases

- 当MCP Server无法连接数据库时，如何处理查询请求？
- 当Agent提交的经验数据量过大时，系统如何处理？
- 当多个Agent同时查询相同的关键词时，系统性能如何保证？
- 当经验记录的context字段包含代码片段时，系统通过自动脱敏处理进行过滤（移除敏感信息、变量名匿名化等）
- 当搜索关键词没有匹配结果时，系统只显示"未找到匹配结果"，不提供任何推荐
- 当管理员审核时发现经验记录质量不高，系统支持批量删除和批量恢复功能，但不支持批量编辑（避免误操作）
- 当MCP Client和Server之间的网络连接不稳定时，如何处理请求失败？
- 当经验记录被多次查询但从未被使用时，是否需要标记为低价值？
- 当平台中经验记录数量非常大时，搜索和查询的响应时间如何保证？
- 当Agent提交的经验与现有记录重复时，系统识别重复记录但不做特殊处理，所有记录都保留并正常显示

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须支持MCP协议，允许Agent通过MCP Client与MCP Server通信
- **FR-002**: MCP Server必须能够接收Agent的查询请求，根据关键词或语义匹配查询经验记录
- **FR-002a**: MCP Server必须对查询结果进行综合排序，以相关性得分为主，结合使用频率（查询次数）和发布时间进行排序
- **FR-002b**: MCP Server默认返回前10条最相关的记录，但必须支持通过参数请求更多记录（如20条、50条）
- **FR-003**: MCP Server必须能够按照固定格式返回查询结果，包含经验记录的关键信息，结果按综合排序规则排列，默认返回前10条
- **FR-004**: MCP Client必须能够分析Agent的需求，将需求转换为MCP Server支持的查询格式
- **FR-005**: MCP Client必须能够解析MCP Server返回的结果，并按照固定格式返回给Agent
- **FR-006**: MCP Client必须能够总结Agent与用户的交互经验，提取关键信息（问题描述、解决方案、上下文等）
- **FR-006a**: MCP Client在总结经验时，如果context字段包含代码片段，必须对代码进行自动脱敏处理（移除敏感信息、API密钥、密码等，对变量名进行匿名化）
- **FR-006b**: MCP Client在总结经验后，必须提示用户确认是否提交，只有用户同意后才提交到MCP Server
- **FR-007**: MCP Client必须能够将用户确认后的经验按照固定格式提交到MCP Server
- **FR-008**: 系统必须提供Web界面，包括首页、搜索页、列表页和登录页
- **FR-009**: 系统必须支持用户通过Web界面搜索经验记录，支持关键词搜索和筛选，搜索结果按综合排序规则排列（相关性得分为主，结合使用频率和发布时间），默认显示前10条，支持分页加载更多
- **FR-009a**: 当搜索没有匹配结果时，系统只显示"未找到匹配结果"，不提供任何推荐
- **FR-010**: 系统必须支持用户浏览经验记录列表，查看详细信息
- **FR-011**: 系统必须支持用户登录功能，验证用户身份（仅用于后台管理功能）
- **FR-011b**: 系统初始化时必须创建第一个管理员账户，后续由现有管理员手动添加新管理员账户
- **FR-011a**: 系统必须支持MCP Client和Web界面的匿名访问，用户无需注册即可使用查询、浏览和搜索功能
- **FR-012**: 系统必须提供管理后台，包括控制面板、数据审核页、数据编辑页和系统设置页（需要登录访问）
- **FR-012a**: 系统必须支持管理员添加新管理员账户的功能，只有现有管理员可以执行此操作
- **FR-013**: 系统必须支持管理员审核和管理已发布的经验记录，可以编辑、删除或恢复记录
- **FR-013a**: 系统必须支持管理员的批量操作功能，包括批量删除和批量恢复，但不支持批量编辑（避免误操作）
- **FR-014**: 系统必须支持管理员编辑经验记录的内容，修改后保存
- **FR-015**: 系统必须支持系统设置功能，包括AI集成配置（用于经验总结和查询优化）
- **FR-016**: 系统必须保存经验记录，包括问题描述、解决方案、上下文信息、关键字、创建时间等
- **FR-017**: 系统必须支持经验记录的状态管理（已发布/已删除），新提交的记录自动发布为"已发布"状态
- **FR-017a**: 系统必须支持经验记录提交后自动发布，无需人工审核即可被查询使用
- **FR-017b**: 系统必须支持经验记录的软删除功能，删除后记录标记为已删除状态，数据永久归档但不可查询，管理员可随时恢复
- **FR-019**: 系统必须验证MCP Client提交的数据格式，拒绝不符合格式要求的提交
- **FR-019a**: 系统必须验证提交的经验记录中context字段如果包含代码片段，是否已进行脱敏处理，拒绝包含未脱敏敏感信息的提交
- **FR-020**: 系统必须记录经验记录的查询次数和使用情况，用于优化推荐算法和排序权重计算
- **FR-021**: 系统必须支持经验记录的关键字分类，便于检索和管理
- **FR-021a**: 系统必须支持AI自动生成关键字，但用户提交经验时可以编辑或添加自定义关键字，管理员也可以修改关键字。关键字不需要预先定义，支持灵活添加
- **FR-022**: 系统必须提供API接口供MCP Server使用，支持查询和保存操作
- **FR-022b**: 平台必须官方发布MCP Client，提供安装包和详细的安装配置文档，确保用户能够正确安装和配置
- **FR-022a**: 系统必须支持无配额限制的MCP查询和提交操作，所有用户都可以免费无限制使用
- **FR-023**: 系统必须支持经验记录的权限控制，确保只有已发布的记录可以被公开查询，所有用户都可以查询所有已发布的记录（全局共享）
- **FR-024**: 系统必须支持经验记录的去重识别功能，能够识别重复或高度相似的记录（相似度超过90%），但不对重复记录进行特殊处理，所有记录都保留并正常显示

### Key Entities *(include if feature involves data)*

- **经验记录（Experience Record）**: 代表一次成功的问题解决经验，包含问题描述、根本原因、解决方案、上下文信息（包含代码片段，需脱敏）、关键字（AI自动生成，用户和管理员可编辑）、创建时间、更新时间、状态（已发布/已删除）、提交者信息、查询次数、使用统计、删除时间等属性。新提交的记录默认自动发布为"已发布"状态。已删除的记录永久归档但不可查询，管理员可随时恢复

- **用户（User）**: 代表平台用户，包含用户ID、用户名、邮箱、密码（加密）、角色（普通用户/管理员）、创建时间、最后登录时间等属性

- **查询请求（Query Request）**: 代表Agent通过MCP Client发起的查询，包含查询关键词、查询时间、返回结果数量、查询来源等属性

- **提交记录（Submission Record）**: 代表Agent通过MCP Client提交的经验，包含原始数据、处理后的数据、提交时间、处理状态、审核结果等属性

- **关键字（Keyword）**: 代表经验记录的关键字，用于搜索和分类。关键字不需要预先定义，由AI自动生成或用户手动添加。关键字会自动转换为小写并去除首尾空格（基础处理），允许不一致的关键字存在（如node、nodejs、node.js可以同时存在）

- **审核记录（Review Record）**: 代表管理员对经验记录的审核操作，包含审核时间、审核人、审核结果、审核意见等属性

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Agent通过MCP Client查询相关经验时，90%的查询请求能在2秒内返回结果
- **SC-002**: Agent通过MCP Client提交经验时，95%的提交请求能在1秒内完成保存
- **SC-003**: 用户通过Web界面搜索经验时，搜索结果在1秒内显示
- **SC-004**: 平台能够支持至少1000个并发MCP查询请求而不出现性能 degradation
- **SC-005**: 经验记录的查询准确率（返回结果与查询意图的相关性）达到80%以上
- **SC-006**: 管理员审核经验记录时，单个记录的审核操作在3秒内完成
- **SC-007**: 平台能够存储至少10万条经验记录而不影响查询性能
- **SC-008**: MCP Client和Server之间的通信成功率（请求成功返回结果的比例）达到99%以上
- **SC-009**: 用户通过Web界面浏览经验列表时，页面加载时间在2秒内完成
- **SC-010**: 经验记录的平均查询次数（衡量记录价值）在发布后30天内达到至少5次
- **SC-011**: 通过使用平台经验，Agent解决问题的对话轮次减少30%以上
- **SC-012**: 系统能够识别经验记录的重复率（相似度超过90%的记录），用于统计和分析，但不作为限制条件

## Clarifications

### Session 2025-01-27

- Q: 经验记录中是否允许包含用户的实际代码片段、项目结构或敏感业务信息？如果需要包含，平台如何保护用户隐私和数据安全？ → A: 允许在context字段中包含代码片段，但必须经过自动脱敏处理（移除敏感信息、变量名匿名化等）
- Q: MCP Client的使用是否需要用户注册账户，还是可以匿名使用？Web界面的浏览和搜索功能是否需要登录？ → A: MCP Client和Web界面完全匿名使用，无需注册即可使用所有功能；后台管理需要登录
- Q: 所有通过MCP Client提交的经验记录是否必须经过人工审核才能被查询使用？还是允许自动发布，仅在发现问题时进行人工干预？ → A: 经验记录自动发布并立即可被查询，但管理员可以随时审核、编辑或删除已发布的记录
- Q: 平台是免费使用还是采用付费模式？MCP查询和提交是否有配额限制（如每日查询次数、提交次数）？ → A: 平台完全免费使用，MCP查询和提交都没有配额限制
- Q: 经验记录是全局共享（所有用户都能查询到所有已发布的记录），还是需要支持按用户、组织或项目进行数据隔离？ → A: 经验记录全局共享，所有用户都能查询到所有已发布的记录，最大化经验复用价值
- Q: Agent什么时候应该自动提交经验？是每次成功解决问题后都提交，还是需要用户确认？ → A: Agent总结经验后提示用户确认，用户同意后才提交
- Q: 当查询返回多条经验记录时，如何排序？按相关性、时间、使用频率？ → A: 综合排序：相关性得分为主，结合使用频率（查询次数）和发布时间
- Q: 当系统识别出重复或高度相似的记录时，如何处理？删除、合并还是保留？ → A: 不做特殊处理，所有记录都保留并正常显示
- Q: 管理员是如何产生的？是否需要多级管理员？普通用户能否申请成为管理员？ → A: 系统初始化时创建第一个管理员账户，后续由现有管理员手动添加新管理员
- Q: 已删除的经验记录是永久删除还是归档？是否需要支持恢复？ → A: 软删除并永久归档，删除后数据保留但不可查询，管理员可随时恢复
- Q: 当查询匹配到大量经验记录时，是否需要限制返回数量？返回多少条？ → A: 默认返回前10条最相关的记录，用户可以通过参数请求更多（如20条、50条）
- Q: 经验记录的标签是自动生成还是手动添加？用户能否自定义标签？ → A: AI自动生成关键字，但用户提交时可以编辑或添加自定义关键字，管理员也可以修改。关键字不需要预先定义，支持灵活添加，系统会自动规范化处理变体（如node、nodejs、node.js）
- Q: MCP Client如何分发给用户？是否需要官方发布？ → A: 平台官方发布MCP Client，提供安装包和详细的安装配置文档
- Q: 当用户搜索没有匹配结果时，系统是否提供相关推荐？ → A: 不提供任何推荐，只显示"未找到匹配结果"
- Q: 管理员是否需要批量操作功能（批量删除、编辑等）？ → A: 支持批量删除和批量恢复，但不支持批量编辑（避免误操作）

## Assumptions & Dependencies

### Assumptions

- MCP协议已经标准化，Agent和MCP Client/Server之间的通信协议是稳定和可用的
- Agent具备调用MCP Client的能力，能够集成MCP Client到其工作流程中
- AI服务（用于经验总结和查询优化）是可用的，能够提供稳定的API接口
- 用户和管理员具备基本的Web浏览器使用能力
- 网络连接稳定，MCP Client和Server之间能够正常通信
- 经验记录的数据格式在后续规划阶段会详细定义，当前假设为结构化的文本数据
- 平台初期数据量较小，随着使用逐渐增长，系统需要具备良好的扩展性
- 平台采用完全免费模式，不设置使用配额限制，所有用户都可以无限制使用MCP查询和提交功能

### Dependencies

- **MCP协议规范**: 系统依赖MCP协议的标准实现，需要确保MCP Client和Server遵循相同的协议规范
- **MCP Client分发**: 平台需要官方发布MCP Client，提供安装包和详细的安装配置文档，确保用户能够正确安装和配置
- **AI服务**: 系统依赖AI服务进行经验总结和查询优化，需要确保AI服务的可用性和性能
- **数据脱敏服务**: 系统依赖数据脱敏服务对代码片段进行自动脱敏处理，需要确保脱敏算法的准确性和完整性
- **数据库系统**: 系统需要可靠的数据库系统来存储经验记录、用户信息等数据
- **Web服务器**: Web界面需要Web服务器来提供HTTP服务
- **认证服务**: 用户登录和管理功能需要认证服务的支持
- **网络基础设施**: MCP Client和Server之间的通信依赖稳定的网络连接
